clone_folder: C:\projects\libcmaes
clone_depth: 1
environment:
  matrix:
    - CMAKE_PLATFORM: "Visual Studio 15 2017"
      PYTHON: "C:\\Miniconda3"
      BITNESS: "32"
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
    - CMAKE_PLATFORM: "Visual Studio 15 2017 Win64"
      PYTHON: "C:\\Miniconda3-x64"
      BITNESS: "64"
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017

install:
  - "SET PATH=%PATH%;%PYTHON%;%PYTHON%\\Scripts"
  - "set CFLAGS=/wd4251 /w4275"
  - "set CXXFLAGS=/wd4251 /w4275"
  - cinstall: python
  - appveyor-retry appveyor DownloadFile https://bitbucket.org/eigen/eigen/get/3.3.4.tar.gz
  - 7z x 3.3.4.tar.gz -oc:\projects > nul
  - 7z x c:\projects\3.3.4.tar -oc:\projects > nul
  - cd c:\projects\eigen-eigen-5a0156e40feb
  - mkdir build && cd build
  - cmake -G "%CMAKE_PLATFORM%" -DCMAKE_INSTALL_PREFIX=c:\Libraries\eigen -DCMAKE_BUILD_TYPE=Release ..
  - cmake --build . --config Release --target install

build_script:
  - cd c:\projects\libcmaes
  - mkdir build && cd build
  - cmake -G "%CMAKE_PLATFORM%" -DCMAKE_INSTALL_PREFIX=c:\Libraries\libcmaes -DEigen3_DIR=c:\Libraries\eigen\share\eigen3\cmake -DBOOST_ROOT="C:\Libraries\boost_1_67_0" ..
  - cmake --build . --config Release --target install
  - ctest -C Release

artifacts:
  - path: 'build\src\Release\*'
    name: libs
  - path: 'build\examples\Release\*'
    name: examples
  - path: 'build\tests\Release\*'
    name: tests
